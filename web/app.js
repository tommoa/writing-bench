var j=(K,N=document)=>N.querySelector(K),M=(K,N=document)=>[...N.querySelectorAll(K)];function q(K,N={},...W){let V=document.createElement(K);for(let[U,Z]of Object.entries(N)){if(Z==null)continue;if(U==="className"&&typeof Z==="string")V.className=Z;else if(U.startsWith("on")&&typeof Z==="function")V.addEventListener(U.slice(2).toLowerCase(),Z);else if(U==="innerHTML"&&typeof Z==="string")V.innerHTML=Z;else if(typeof Z==="string")V.setAttribute(U,Z)}for(let U of W)if(typeof U==="string")V.appendChild(document.createTextNode(U));else if(U)V.appendChild(U);return V}var s={index:null},o=null;function l(){let K=new URLSearchParams(location.search),N=K.get("run");if(N)return{page:"run",id:N};if(K.get("page")==="runs")return{page:"runs"};if(K.get("page")==="methodology")return{page:"methodology"};return{page:"dashboard"}}async function Vq(){let K=await fetch("data/runs.json");if(!K.ok)throw Error("No data found. Run a benchmark and export first.");return K.json()}async function Wq(K){let N=await fetch(`data/runs/${K}.json`);if(!N.ok)throw Error(`Run ${K} not found`);return N.json()}function S(K){let N=j("#app");if(N.innerHTML="",typeof K==="string")N.innerHTML=K;else N.appendChild(K)}function e(K){S(`<div id="error">${K}</div>`)}function qq(K){return new Date(K).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Xq(K){if(K>=100)return`${Math.round(K)}`;if(K>=10)return K.toFixed(1);return K.toFixed(2)}function n(K){let N=K.usage.inputTokens+K.usage.outputTokens;if(K.fromCache)return q("p",{className:"muted small mt-1"},`${N} tokens | [cached]`);let W=K.usage.cacheReadTokens?` (${K.usage.cacheReadTokens} cached)`:"",V=K.cost.totalUncached!=null&&K.cost.totalUncached>K.cost.total+0.00005?` (uncached: $${K.cost.totalUncached.toFixed(4)})`:"";return q("p",{className:"muted small mt-1"},`${N} tokens${W} | $${K.cost.total.toFixed(4)}${V} | ${(K.latencyMs/1000).toFixed(1)}s`)}function Yq(K){let N=K.usage?K.usage.inputTokens+K.usage.outputTokens:0;if(K.fromCache)return q("p",{className:"muted small mt-1"},`${N} tokens | [cached]`);let W=K.cost?K.cost.total:0,V=K.latencyMs?(K.latencyMs/1000).toFixed(1):"?";return q("p",{className:"muted small mt-1"},`${N} tokens | $${W.toFixed(4)} | ${V}s`)}function Zq(K){let N=document.createDocumentFragment();if(K.cumulativeElo.writing.length>0)N.appendChild(q("h2",{},"Writer ELO")),N.appendChild(p(K.cumulativeElo.writing,["initial","revised"]));if(K.cumulativeElo.feedback.length>0)N.appendChild(q("h2",{},"Feedback Provider ELO")),N.appendChild(p(K.cumulativeElo.feedback,["feedback"]));if(K.cumulativeElo.byTag&&Object.keys(K.cumulativeElo.byTag).length>0){N.appendChild(q("h2",{},"ELO by Tag"));for(let[W,V]of Object.entries(K.cumulativeElo.byTag)){let U=q("details");U.appendChild(q("summary",{},W)),U.appendChild(q("div",{className:"details-content"},p(V,["initial","revised"]))),N.appendChild(U)}}if(K.eloHistory.length>1)N.appendChild(q("h2",{},"ELO History")),N.appendChild(_q(K.eloHistory));if(K.runs.length>0)N.appendChild(q("h2",{},"Recent Runs")),N.appendChild(Kq(K.runs));if(K.runs.length===0&&K.cumulativeElo.writing.length===0)N.appendChild(q("p",{className:"muted mt-2"},"No benchmark data yet. Run a benchmark and export results."));S(N)}function p(K,N){let W=q("table"),V={initial:"Write",initialJudging:"Judge",feedback:"Feedback",revised:"Revise",revisedJudging:"Re-Judge"},U=(N??[]).filter((G)=>K.some((R)=>(R.costByStage?.[G]??0)>0)).map((G)=>({key:G,label:V[G]??G})),Z=U.length>0,H=[q("th",{className:"rank"},"#"),q("th",{},"Model"),q("th",{className:"sortable"},"ELO"),q("th",{},"Matches")];if(Z)for(let G of U)H.push(q("th",{className:"cost"},G.label));W.appendChild(q("thead",{},q("tr",{},...H)));let J=q("tbody");return K.forEach((G,R)=>{let Q=R===0?"rating top":R===K.length-1?"rating bottom":"rating",Y=[q("td",{className:"rank"},String(R+1)),q("td",{},G.model),q("td",{className:Q},String(G.rating)),q("td",{className:"muted"},String(G.matchCount))];if(Z)for(let F of U){let _=G.costByStage?.[F.key]??0;Y.push(q("td",{className:"cost"},_>0?`$${_.toFixed(4)}`:"-"))}J.appendChild(q("tr",{},...Y))}),W.appendChild(J),W}function _q(K){let N=q("div"),W=new Set;K.forEach((V)=>Object.keys(V.ratings).forEach((U)=>W.add(U)));for(let V of W){let U=K.map((_)=>_.ratings[V]).filter((_)=>_!=null);if(U.length<2)continue;let Z=Math.min(...U),J=Math.max(...U)-Z||1,G=120,R=30,Q=2,Y=U.map((_,T)=>{let C=Q+T/(U.length-1)*(G-2*Q),z=Q+(1-(_-Z)/J)*(R-2*Q);return`${C},${z}`}),F=`<svg viewBox="0 0 ${G} ${R}"><path d="M${Y.join("L")}"/></svg>`;N.appendChild(q("div",{className:"mb-1"},q("span",{},V+" "),q("span",{className:"sparkline",innerHTML:F}),q("span",{className:"muted small"},` ${U[U.length-1]}`)))}return N}function Kq(K){let N=q("ul",{className:"run-list"});for(let W of K){let V=q("a",{href:`?run=${W.id}`},qq(W.timestamp)),U=q("span",{className:"run-meta"},`${W.models.join(", ")} | ${W.promptCount} prompts | $${(W.totalCostUncached??W.totalCost).toFixed(4)}`);N.appendChild(q("li",{},V,U))}return N}function Hq(K){let N=document.createDocumentFragment();if(N.appendChild(q("h2",{},"All Runs")),K.runs.length>0)N.appendChild(Kq(K.runs));else N.appendChild(q("p",{className:"muted mt-2"},"No runs yet. Run a benchmark and export results."));S(N)}function Oq(K){let N=document.createDocumentFragment();N.appendChild(q("p",{},q("a",{href:"?"},"< back to leaderboard")));let W=K.meta.totalCostUncached??K.meta.totalCost;N.appendChild(q("h2",{},`Run: ${qq(K.config.timestamp)} — $${W.toFixed(2)}`));let V=K.config.models.map((Q)=>Q.label).join(", ");if(K.config.judges&&K.config.judges.length>0){let Q=K.config.judges.map((Y)=>Y.label).join(", ");N.appendChild(q("p",{className:"muted"},`Writers: ${V} | Judges: ${Q}`))}else N.appendChild(q("p",{className:"muted"},`Models: ${V}`));let U=K.meta.costByModelByStageUncached??{},Z=K.meta.speedByModel;if(N.appendChild(q("h2",{},"Initial Writer ELO")),N.appendChild(g(K.elo.initial.ratings,U,["initial"],Z)),N.appendChild(q("h2",{},"Revised Writer ELO")),N.appendChild(g(K.elo.revised.ratings,U,["revised"],Z)),K.elo.revised.feedbackRatings&&K.elo.revised.feedbackRatings.length>0)N.appendChild(q("h2",{},"Feedback Provider ELO")),N.appendChild(g(K.elo.revised.feedbackRatings,U,["feedback"],Z));if(K.elo.initial.byTag&&Object.keys(K.elo.initial.byTag).length>0){N.appendChild(q("h2",{},"ELO by Tag"));for(let[Q,Y]of Object.entries(K.elo.initial.byTag)){let F=q("details");F.appendChild(q("summary",{},Q));let _=q("div",{className:"details-content"});if(_.appendChild(q("h4",{},"Initial")),_.appendChild(g(Y,U,["initial"],Z)),K.elo.revised.byTag?.[Q])_.appendChild(q("h4",{},"Revised")),_.appendChild(g(K.elo.revised.byTag[Q],U,["revised"],Z));F.appendChild(_),N.appendChild(F)}}let H=q("div",{className:"section-header"});H.appendChild(q("h2",{},"Outputs by Prompt"));let J=document.createElement("select");J.className="prompt-filter-select",J.appendChild(new Option("All prompts","all"));let G=[...new Set(K.config.prompts.flatMap((Q)=>Q.tags))].sort();if(G.length>1)for(let Q of G)J.appendChild(new Option(`Tag: ${Q}`,`tag:${Q}`));for(let Q of K.config.prompts)J.appendChild(new Option(Q.name,`id:${Q.id}`));H.appendChild(J),N.appendChild(H);let R=q("div",{id:"prompt-sections"});for(let Q of K.config.prompts){let Y=Gq(K,Q);Y.setAttribute("data-prompt-id",Q.id),Y.setAttribute("data-prompt-tags",Q.tags.join(",")),R.appendChild(Y)}N.appendChild(R),J.addEventListener("change",()=>{let Q=J.value;for(let Y of M("[data-prompt-id]",R))if(Q==="all")Y.style.display="";else if(Q.startsWith("tag:")){let F=Q.slice(4),_=(Y.getAttribute("data-prompt-tags")??"").split(",");Y.style.display=_.includes(F)?"":"none"}else if(Q.startsWith("id:")){let F=Q.slice(3);Y.style.display=Y.getAttribute("data-prompt-id")===F?"":"none"}}),N.appendChild(q("h2",{},"Judgments")),N.appendChild(Jq(K)),N.appendChild(q("h2",{},"Run Metadata")),N.appendChild(Rq(K)),S(N)}function d(K,N){return q("div",{className:"cost-item"},q("div",{className:"label"},K),q("div",{className:"value"},N))}function g(K,N,W,V){let U=q("table"),Z={initial:"Write",initialJudging:"Judge",feedback:"Feedback",revised:"Revise",revisedJudging:"Re-Judge"},H=N??{},J=K.map((_)=>_.model),G=(W??[]).filter((_)=>J.some((T)=>(H[T]?.[_]??0)>0)).map((_)=>({key:_,label:Z[_]??_})),R=G.length>0,Q=V!=null&&Object.keys(V).length>0,Y=[q("th",{className:"rank"},"#"),q("th",{},"Model"),q("th",{},"ELO"),q("th",{},"W/L/T")];if(R)for(let _ of G)Y.push(q("th",{className:"cost"},_.label));if(Q)Y.push(q("th",{},"Speed"));U.appendChild(q("thead",{},q("tr",{},...Y)));let F=q("tbody");return K.forEach((_,T)=>{let C=T===0?"rating top":T===K.length-1?"rating bottom":"rating",z=`${_.wins}/${_.losses}/${_.ties}`,D=[q("td",{className:"rank"},String(T+1)),q("td",{},_.model),q("td",{className:C},String(_.rating)),q("td",{className:"wlt"},z)];if(R){let $=H[_.model]??{};for(let y of G){let E=$[y.key]??0;D.push(q("td",{className:"cost"},E>0?`$${E.toFixed(4)}`:"-"))}}if(Q){let $=V[_.model],y=$?`${Xq($.tokensPerSecond)} tok/s`:"-";D.push(q("td",{className:"speed"},y))}F.appendChild(q("tr",{},...D))}),U.appendChild(F),U}function Gq(K,N){let W=q("details");W.appendChild(q("summary",{},`${N.name} (${N.tags.join(", ")})`));let V=q("div",{className:"details-content"});V.appendChild(q("p",{className:"muted small"},N.description));let U=K.samples.filter((Q)=>Q.promptId===N.id&&Q.stage==="initial").sort((Q,Y)=>Q.model.localeCompare(Y.model)||Q.outputIndex-Y.outputIndex);if(U.length===0)return V.appendChild(q("p",{className:"muted"},"No outputs.")),W.appendChild(V),W;let Z=U.length>4,H=q("div"),J=U.map((Q)=>{let F=U.filter((_)=>_.model===Q.model).length>1?` #${Q.outputIndex+1}`:"";return`${Q.model}${F}`});function G(Q){M(".tab-content",H).forEach((F)=>F.classList.remove("active"));let Y=`prompt-${N.id}-${Q}`;j(`#${Y}`,H)?.classList.add("active")}let R;if(Z){let Q=document.createElement("select");Q.className="model-select";for(let Y=0;Y<J.length;Y++)Q.appendChild(new Option(J[Y],String(Y)));Q.addEventListener("change",()=>{G(Number(Q.value))}),R=q("div",{className:"tabs tabs-dropdown"}),R.appendChild(Q)}else{R=q("div",{className:"tabs"});for(let Q=0;Q<J.length;Q++){let Y=q("button",{className:Q===0?"tab active":"tab",onClick:()=>{M(".tab",R).forEach((F)=>F.classList.remove("active")),Y.classList.add("active"),G(Q)}},J[Q]);R.appendChild(Y)}}return U.forEach((Q,Y)=>{let F=`prompt-${N.id}-${Y}`,_=q("div",{id:F,"data-sample-id":Q.id,className:Y===0?"tab-content active":"tab-content"});_.appendChild(q("div",{className:"output-text"},Q.text)),_.appendChild(n(Q));let T=K.judgments.filter((z)=>z.sampleA===Q.id||z.sampleB===Q.id).length;if(T>0)_.appendChild(q("button",{className:"view-judgments-btn",onClick:()=>o?.focusSample(Q.id)},`view ${T} judgments →`));let C=K.feedback.filter((z)=>z.targetSampleId===Q.id).sort((z,D)=>z.sourceModel.localeCompare(D.sourceModel));for(let z of C){let D=q("details");D.appendChild(q("summary",{},`Feedback from ${z.sourceModel}`));let $=q("div",{className:"details-content"}),y=q("div",{className:"feedback-text"});y.appendChild(document.createTextNode(z.text)),y.appendChild(Yq(z)),$.appendChild(y);let E=K.samples.find((k)=>k.stage==="revised"&&k.feedbackUsed===z.id&&k.promptId===N.id);if(E){let k=q("div",{className:"revision-nested",id:`sample-${E.id}`});k.appendChild(q("div",{className:"muted small"},`${E.model}'s revision:`)),k.appendChild(q("div",{className:"output-text"},E.text)),k.appendChild(n(E));let A=K.judgments.filter((x)=>x.sampleA===E.id||x.sampleB===E.id).length;if(A>0)k.appendChild(q("button",{className:"view-judgments-btn",onClick:()=>o?.focusSample(E.id)},`view ${A} judgments →`));$.appendChild(k)}D.appendChild($),_.appendChild(D)}H.appendChild(_)}),V.appendChild(R),V.appendChild(H),W.appendChild(V),W}function a(K){let N=K.parentElement;while(N){if(N.tagName==="DETAILS")N.setAttribute("open","");N=N.parentElement}}function t(K,N){let W=N.samples.find((Z)=>Z.id===K);if(!W)return;let V=N.samples.filter((Z)=>Z.promptId===W.promptId&&Z.stage==="initial").sort((Z,H)=>Z.model.localeCompare(H.model)||Z.outputIndex-H.outputIndex),U=null;if(W.stage==="initial"){let Z=V.findIndex((G)=>G.id===K);if(Z===-1)return;let H=`prompt-${W.promptId}-${Z}`,J=j(`#${H}`);if(!J)return;a(J),r(J,Z),U=J}else{let Z=j(`#sample-${K}`);if(!Z)return;if(a(Z),W.originalSampleId){let H=V.findIndex((J)=>J.id===W.originalSampleId);if(H!==-1){let J=`prompt-${W.promptId}-${H}`,G=j(`#${J}`);if(G)r(G,H)}}U=Z}if(U)U.scrollIntoView({behavior:"smooth",block:"start"}),U.classList.add("scroll-highlight"),U.addEventListener("animationend",()=>U.classList.remove("scroll-highlight"),{once:!0})}function r(K,N){let W=K.parentElement;if(!W)return;let V=W.previousElementSibling;if(V&&V.classList.contains("tabs")){let U=j("select.model-select",V);if(U)U.value=String(N);M(".tab",V).forEach((Z,H)=>{Z.classList.toggle("active",H===N)})}M(".tab-content",W).forEach((U)=>U.classList.remove("active")),K.classList.add("active")}function Fq(K,N){let W=N.get(K.sampleA),V=N.get(K.sampleB);if(K.stage==="improvement"){let U=W?.stage==="initial",Z=U?W:V,H=U?V:W,J=H?.feedbackModel??"?",G=`${Z?.model??"?"} (original)`,R=`${H?.model??"?"} (revised, fb: ${J})`,Q;if(K.winner==="tie")Q="Tie";else Q=(K.winner==="A"?W:V)?.stage==="initial"?"original":"revised";return U?{labelA:G,labelB:R,winnerLabel:Q}:{labelA:R,labelB:G,winnerLabel:Q}}if(K.stage==="revised"){let U=W?.feedbackModel?` (fb: ${W.feedbackModel})`:"",Z=V?.feedbackModel?` (fb: ${V.feedbackModel})`:"";return{labelA:`${W?.model??"?"}${U}`,labelB:`${V?.model??"?"}${Z}`,winnerLabel:K.winner==="tie"?"Tie":K.winner==="A"?W?.model??"?":V?.model??"?"}}return{labelA:W?.model??"?",labelB:V?.model??"?",winnerLabel:K.winner==="tie"?"Tie":K.winner==="A"?W?.model??"?":V?.model??"?"}}function Jq(K){let N=q("div");N.id="judgments-section";let W=K.judgments;if(W.length===0)return N.appendChild(q("p",{className:"muted"},"No judgments.")),N;let V=new Map(K.samples.map((X)=>[X.id,X])),U=[...new Set(W.map((X)=>X.stage))].sort(),Z=[...new Set(W.map((X)=>X.judgeModel))].sort(),H=[...new Set(K.samples.map((X)=>X.model))].sort(),J=K.config.prompts,G=[...new Set(J.flatMap((X)=>X.tags))].sort(),R="all",Q="all",Y="all",F="all",_="all",T=null,C=25,z=0,D=q("div",{className:"judgment-filters"}),$=document.createElement("select");if($.appendChild(new Option("All prompts","all")),G.length>1)for(let X of G)$.appendChild(new Option(`Tag: ${X}`,`tag:${X}`));for(let X of J)$.appendChild(new Option(X.name,`id:${X.id}`));let y=document.createElement("select");y.appendChild(new Option("All stages","all"));for(let X of U)y.appendChild(new Option(X,X));let E=document.createElement("select");E.appendChild(new Option("All judges","all"));for(let X of Z)E.appendChild(new Option(X,X));let k=document.createElement("select");k.appendChild(new Option("All models","all"));for(let X of H)k.appendChild(new Option(X,X));let A=document.createElement("select");A.appendChild(new Option("All models","all"));for(let X of H)A.appendChild(new Option(X,X));D.appendChild(q("span",{className:"muted small"},"Prompt: ")),D.appendChild($),D.appendChild(q("span",{className:"muted small"}," Stage: ")),D.appendChild(y),D.appendChild(q("span",{className:"muted small"}," Judge: ")),D.appendChild(E),D.appendChild(q("span",{className:"muted small"}," Model A: ")),D.appendChild(k),D.appendChild(q("span",{className:"muted small"}," vs B: ")),D.appendChild(A),N.appendChild(D);let x=q("div",{className:"sample-filter-badge"});x.style.display="none",N.appendChild(x);let v=q("div",{className:"h2h-summary"});v.style.display="none",N.appendChild(v);let b=q("div");N.appendChild(b);let P=()=>{let X=W;if(T){X=X.filter((w)=>w.sampleA===T||w.sampleB===T);let O=V.get(T);x.innerHTML="",x.style.display="flex",x.appendChild(q("span",{},`Showing judgments for ${O?.model??"unknown"}'s output`)),x.appendChild(q("button",{className:"badge-clear",onClick:()=>{T=null,P()}},"✕ clear"))}else x.style.display="none";if(_!=="all"){if(_.startsWith("tag:")){let O=_.slice(4),w=new Set(J.filter((L)=>L.tags.includes(O)).map((L)=>L.id));X=X.filter((L)=>w.has(L.promptId))}else if(_.startsWith("id:")){let O=_.slice(3);X=X.filter((w)=>w.promptId===O)}}if(R!=="all")X=X.filter((O)=>O.stage===R);if(Q!=="all")X=X.filter((O)=>O.judgeModel===Q);if(Y!=="all"&&F!=="all")X=X.filter((O)=>{let w=V.get(O.sampleA)?.model,L=V.get(O.sampleB)?.model;return w===Y&&L===F||w===F&&L===Y});else if(Y!=="all")X=X.filter((O)=>{let w=V.get(O.sampleA)?.model,L=V.get(O.sampleB)?.model;return w===Y||L===Y});else if(F!=="all")X=X.filter((O)=>{let w=V.get(O.sampleA)?.model,L=V.get(O.sampleB)?.model;return w===F||L===F});if(Y!=="all"&&F!=="all"&&Y!==F){let O=0,w=0,L=0;for(let I of X){let h=V.get(I.sampleA)?.model;if(I.winner==="tie")L++;else if(I.winner==="A")if(h===Y)O++;else w++;else if(h===Y)w++;else O++}v.innerHTML="",v.style.display="block",v.appendChild(q("div",{className:"h2h-record"},q("span",{className:"h2h-model"},Y),q("span",{className:"h2h-wins"},` ${O}W`),q("span",{className:"muted"}," / "),q("span",{className:"h2h-losses"},`${w}L`),q("span",{className:"muted"}," / "),q("span",{className:"h2h-ties"},`${L}T`),q("span",{className:"muted"}," vs "),q("span",{className:"h2h-model"},F)))}else v.style.display="none";b.innerHTML="";let B=Math.max(1,Math.ceil(X.length/C));if(z>=B)z=B-1;let u=z*C,Nq=X.slice(u,u+C);b.appendChild(q("p",{className:"muted small mb-1"},`${u+1}–${Math.min(u+C,X.length)} of ${X.length} judgments`));for(let O of Nq){let w=K.config.prompts.find((c)=>c.id===O.promptId),{labelA:L,labelB:I,winnerLabel:h}=Fq(O,V),m=O.winner==="A"?"a":O.winner==="B"?"b":"tie",Qq=q("a",{href:"#",className:"judgment-sample-link",onClick:(c)=>{c.preventDefault(),t(O.sampleA,K)}},L),Uq=q("a",{href:"#",className:"judgment-sample-link",onClick:(c)=>{c.preventDefault(),t(O.sampleB,K)}},I),f=q("div",{className:"judgment"});if(f.appendChild(q("div",{className:"judgment-header"},q("span",{className:"judgment-stage"},O.stage),q("span",{},` ${w?.name??O.promptId}`),q("span",{className:"judgment-judge"},`Judge: ${O.judgeModel}`))),f.appendChild(q("div",{className:"judgment-matchup"},Qq,q("span",{className:"muted"}," vs "),Uq)),f.appendChild(q("div",{className:"judgment-result"},q("span",{className:"muted"},"→ "),q("span",{className:`judgment-winner ${m}`},h))),O.reasoning)f.appendChild(q("div",{className:"judgment-reasoning"},O.reasoning));b.appendChild(f)}if(X.length>10){let O=q("div",{className:"pagination"}),w=q("button",{disabled:z===0,onClick:()=>{z--,P()}},"< prev"),L=q("button",{disabled:z>=B-1,onClick:()=>{z++,P()}},"next >");O.appendChild(w),O.appendChild(q("span",{className:"muted"},` page ${z+1} of ${B} `)),O.appendChild(L);let I=document.createElement("select");I.className="page-size-select";for(let h of[10,25,50,100]){let m=new Option(`${h} per page`,String(h));if(h===C)m.selected=!0;I.appendChild(m)}I.addEventListener("change",()=>{C=Number(I.value),z=0,P()}),O.appendChild(I),b.appendChild(O)}};return $.addEventListener("change",()=>{_=$.value,T=null,z=0,P()}),y.addEventListener("change",()=>{R=y.value,T=null,z=0,P()}),E.addEventListener("change",()=>{Q=E.value,T=null,z=0,P()}),k.addEventListener("change",()=>{Y=k.value,T=null,z=0,P()}),A.addEventListener("change",()=>{F=A.value,T=null,z=0,P()}),o={focusSample(X){let B=V.get(X);T=X,_="all",R="all",Q="all",Y=B?.model??"all",F="all",$.value="all",y.value="all",E.value="all",k.value=Y,A.value="all",P(),N.scrollIntoView({behavior:"smooth"})},focusModel(X){T=null,_="all",Y=X,F="all",R="all",Q="all",$.value="all",y.value="all",E.value="all",k.value=X,A.value="all",P(),N.scrollIntoView({behavior:"smooth"})}},P(),N}function Rq(K){let N=q("div"),W=q("div",{className:"cost-grid"}),V=K.meta.totalCostUncached??K.meta.totalCost;if(W.appendChild(d("Total Cost",`$${V.toFixed(4)}`)),W.appendChild(d("Duration",`${(K.meta.durationMs/1000).toFixed(1)}s`)),W.appendChild(d("Total Tokens",K.meta.totalTokens.toLocaleString())),N.appendChild(W),K.modelInfo&&Object.keys(K.modelInfo).length>0){N.appendChild(q("h3",{},"Models"));let U=q("div",{className:"model-cards"});for(let[Z,H]of Object.entries(K.modelInfo))U.appendChild(q("div",{className:"model-card"},q("div",{className:"name"},Z),q("div",{className:"detail"},H.name),q("div",{className:"detail"},`Family: ${H.family}`),q("div",{className:"detail"},`$${H.costPer1MInput}/M in, $${H.costPer1MOutput}/M out`),H.releaseDate?q("div",{className:"detail"},`Released: ${H.releaseDate}`):null,q("div",{className:"detail"},H.openWeights?"Open weights":"Proprietary")));N.appendChild(U)}return N}function zq(){let K=q("div",{className:"methodology"},q("h2",{},"How Models Are Compared"),q("p",{},'Writing quality is evaluated through pairwise blind judging. For each prompt, an LLM judge is shown two writing samples labeled "Sample A" and "Sample B" with no indication of which model produced which text. The judge decides which sample is better (A, B, or tie) and provides reasoning.'),q("p",{},"Each prompt defines its own judging criteria tailored to the genre. A sermon prompt might specify theological accuracy and pastoral warmth, while a short story prompt might focus on narrative voice and character interiority. The judge evaluates against all listed criteria holistically."),q("p",{},"Judging uses structured JSON output (a Zod schema requesting winner and reasoning). If a judge model does not support structured output, the system falls back to free-text generation and extracts JSON from the response."),q("h3",{},"Position Bias Mitigation"),q("p",{},"LLMs can exhibit position bias — a tendency to favor whichever sample "+"appears first. To counteract this, the benchmark randomly swaps the presentation order of each pair with 50% probability. After the judge responds, the winner is mapped back to the canonical ordering. This ensures that any position preference cancels out over many comparisons."),q("h2",{},"The Benchmark Pipeline"),q("p",{},"The benchmark runs as a reactive pipeline. Tasks fire as soon as their dependencies are met rather than waiting for entire stages to complete. Judging begins as soon as two samples for the same prompt exist; feedback starts as soon as a sample is written; revisions start as soon as feedback arrives."),q("ol",{},q("li",{},q("strong",{},"Write")," — Each model generates an output for each prompt."),q("li",{},q("strong",{},"Judge (initial)")," — Pairwise blind comparison of initial outputs. Every unique "+"pair of samples for a prompt is judged by every judge model."),q("li",{},q("strong",{},"Feedback")," — Each model critiques every other model’s initial output, "+"identifying strengths and areas for improvement."),q("li",{},q("strong",{},"Revise")," — The original writer revises its piece using another model’s "+"feedback."),q("li",{},q("strong",{},"Judge (revised)")," — Revised outputs are compared head-to-head. Only revisions "+"that used feedback from the same source model are compared, so the comparison isolates writing ability from feedback quality."),q("li",{},q("strong",{},"Judge (improvement)")," — Each revision is compared against its own original to "+"measure whether the feedback actually helped improve the writing.")),q("h2",{},"Bradley-Terry Rating System"),q("p",{},"Ratings are computed using the Bradley-Terry model, a maximum likelihood estimation method for pairwise comparison data. Unlike sequential ELO (where processing the same judgments in a different order gives different ratings), Bradley-Terry computes strength parameters from all outcomes simultaneously. The same set of judgments always produces the same ratings."),q("h3",{},"The Algorithm"),q("p",{},"Each model is assigned a strength parameter p, initially set to 1. The algorithm iterates:"),q("div",{className:"formula"},`For each model i:
`+`  scoreᵢ = winsᵢ + 0.5 × tiesᵢ
`+`  expectedᵢ = Σⱼ Nᵢⱼ × pᵢ / (pᵢ + pⱼ)
`+`  pᵢ ← (scoreᵢ / expectedᵢ) × pᵢ

`+`Normalize all strengths by their geometric mean.
`+"Repeat until convergence (max relative change < 10⁻⁶, up to 50 iterations)."),q("p",{},"A model’s strength increases when its observed win "+"rate exceeds what the current strength estimates predict, and decreases when it falls short. Ties count as half a win for each side. The geometric mean normalization prevents strengths from drifting to infinity."),q("h3",{},"ELO-Scale Conversion"),q("p",{},"Bradley-Terry strengths are converted to a familiar ELO-like scale:"),q("div",{className:"formula"},"rating = 400 × log₁₀(strength) + 1500"),q("p",{},"This means a model whose BT strength is 10× another’s will be "+"rated 400 points higher, matching the standard ELO interpretation where a 400-point gap implies roughly 10:1 win odds."),q("h2",{},"Three Rating Types"),q("h3",{},"Writing ELO"),q("p",{},"Direct head-to-head writing quality. Two writing samples for the same prompt are shown to a judge; the winning model gets credit. Both initial and revised stage judgments contribute to writing ratings."),q("h3",{},"Feedback ELO"),q("p",{},"How useful a model’s editorial feedback is, measured indirectly. "+"The system does not compare feedback texts directly. Instead, it uses improvement judgments (revision vs. original) to determine whether feedback led to a better revision."),q("p",{},"The algorithm groups improvement judgments by prompt and judge, then pairs up different feedback providers within each group. If "+"feedback model A’s revision beat the original but feedback model "+"B’s did not, A wins. If both improved or both failed, it’s a tie. "+"These synthetic pairwise outcomes are then fed into the same Bradley-Terry computation."),q("h3",{},"Per-Tag ELO"),q("p",{},'Each prompt has genre tags (e.g. "speech", "theological", "creative"). Per-tag ratings run the same Bradley-Terry computation restricted to judgments from prompts with a given tag. This reveals '+"category-specific strengths — a model might excel at essays but "+"struggle with creative fiction."),q("h2",{},"Cumulative Ratings"),q("p",{},"Ratings accumulate across multiple benchmark runs. Rather than applying sequential updates (which would be order-dependent), the system stores pairwise records: for each pair of models, the total number of wins for each side and ties."),q("p",{},"When a new run completes, its pairwise outcomes are merged with the existing accumulated records. Ratings are then recomputed from scratch using Bradley-Terry on the full merged dataset. This means the order in which runs are processed does not affect the final ratings."),q("p",{},"The leaderboard on the dashboard page always reflects the cumulative ratings across all runs. Individual run pages show "+"ratings computed from that run’s judgments alone."),q("h2",{},"Reading the Results"),q("ul",{},q("li",{},q("strong",{},"1500")," is the baseline rating. A model with no wins or losses, or one at the geometric mean of all model strengths, sits at 1500."),q("li",{},q("strong",{},"400-point gap")," corresponds to roughly 10:1 expected win odds. A model rated 1900 is expected to beat a 1500-rated model about 90% of the time."),q("li",{},q("strong",{},"W / L / T")," are raw win, loss, and tie counts from all pairwise matches the model participated in. These are the direct inputs to the Bradley-Terry computation."),q("li",{},q("strong",{},"Matches")," is the total number of pairwise comparisons involving the model (W + L + T). More matches produce more reliable ratings.")),q("p",{className:"note"},"Ratings from a small number of matches should be interpreted cautiously. As more runs accumulate, the cumulative ratings converge toward stable values."));S(K.outerHTML)}async function Tq(){M(".nav a[data-page]").forEach((K)=>{K.addEventListener("click",(N)=>{N.preventDefault(),history.pushState(null,"",K.getAttribute("href")),i()})}),window.addEventListener("popstate",i);try{s.index=await Vq()}catch(K){if(l().page!=="methodology"){e(K instanceof Error?K.message:String(K));return}}i()}function i(){let{page:K,id:N}=l();switch(o=null,M(".nav a").forEach((W)=>{let V=W.getAttribute("data-page"),U=V===K||K==="run"&&V==="runs";W.classList.toggle("active",U)}),K){case"dashboard":Zq(s.index);break;case"runs":Hq(s.index);break;case"run":Dq(N);break;case"methodology":zq();break}}async function Dq(K){S('<div id="loading">loading run...</div>');try{let N=await Wq(K);Oq(N)}catch(N){e(N instanceof Error?N.message:String(N))}}Tq();
